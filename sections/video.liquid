<section class="section-spacing overflow-hidden" data-section-id="{{ section.id }}" data-section-type="video">
  <div class="container-flux">
    
    {%- if section.settings.heading != blank -%}
      <div class="text-center mb-12">
        <h2 class="mb-4">
          {%- if section.settings.heading_gradient -%}
            <span class="gradient-text">{{ section.settings.heading }}</span>
          {%- else -%}
            {{ section.settings.heading }}
          {%- endif -%}
        </h2>
      </div>
    {%- endif -%}

    <div class="max-w-5xl mx-auto">
      <div class="relative aspect-video rounded-2xl overflow-hidden bg-bg-secondary">
        
        {%- if section.settings.video_url != blank -%}
          {%- liquid
            assign video_id = section.settings.video_url.id
            assign video_type = section.settings.video_url.type
          -%}

          {%- if video_type == 'youtube' -%}
            <iframe
              src="https://www.youtube.com/embed/{{ video_id }}?enablejsapi=1"
              class="absolute inset-0 w-full h-full"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
              title="{{ section.settings.description | escape }}"
              loading="lazy"
            ></iframe>
          {%- elsif video_type == 'vimeo' -%}
            <iframe
              src="https://player.vimeo.com/video/{{ video_id }}"
              class="absolute inset-0 w-full h-full"
              allow="autoplay; fullscreen; picture-in-picture"
              allowfullscreen
              title="{{ section.settings.description | escape }}"
              loading="lazy"
            ></iframe>
          {%- endif -%}

        {%- elsif section.settings.video_shopify != blank -%}
          {{ section.settings.video_shopify | video_tag: 
            image_size: '1100x',
            autoplay: section.settings.autoplay,
            loop: section.settings.loop_video,
            controls: true,
            muted: section.settings.autoplay,
            class: 'absolute inset-0 w-full h-full object-cover'
          }}

        {%- else -%}
          {%- if section.settings.cover_image != blank -%}
            <img
              srcset="
                {%- if section.settings.cover_image.width >= 375 -%}{{ section.settings.cover_image | image_url: width: 375 }} 375w,{%- endif -%}
                {%- if section.settings.cover_image.width >= 750 -%}{{ section.settings.cover_image | image_url: width: 750 }} 750w,{%- endif -%}
                {%- if section.settings.cover_image.width >= 1100 -%}{{ section.settings.cover_image | image_url: width: 1100 }} 1100w,{%- endif -%}
                {%- if section.settings.cover_image.width >= 1500 -%}{{ section.settings.cover_image | image_url: width: 1500 }} 1500w,{%- endif -%}
                {{ section.settings.cover_image | image_url }} {{ section.settings.cover_image.width }}w
              "
              sizes="(min-width: 1100px) 1100px, 100vw"
              src="{{ section.settings.cover_image | image_url: width: 1500 }}"
              loading="lazy"
              alt="{{ section.settings.cover_image.alt | escape }}"
              width="{{ section.settings.cover_image.width }}"
              height="{{ section.settings.cover_image.height }}"
              class="absolute inset-0 w-full h-full object-cover"
            >
          {%- else -%}
            <div class="absolute inset-0 flex items-center justify-center">
              <p class="text-text-secondary">{{ 'sections.video.no_video' | t }}</p>
            </div>
          {%- endif -%}
        {%- endif -%}
      </div>

      {%- if section.settings.description != blank -%}
        <div class="text-center mt-6">
          <p class="text-text-secondary">{{ section.settings.description }}</p>
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Video",
  "tag": "section",
  "class": "video-section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "checkbox",
      "id": "heading_gradient",
      "label": "Use gradient for heading",
      "default": true
    },
    {
      "type": "video_url",
      "id": "video_url",
      "accept": ["youtube", "vimeo"],
      "label": "Video URL",
      "info": "Supports YouTube and Vimeo"
    },
    {
      "type": "video",
      "id": "video_shopify",
      "label": "Shopify-hosted video"
    },
    {
      "type": "image_picker",
      "id": "cover_image",
      "label": "Cover image",
      "info": "Shown if no video is added"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay",
      "default": false,
      "info": "Video will be muted if autoplay is enabled"
    },
    {
      "type": "checkbox",
      "id": "loop_video",
      "label": "Loop video",
      "default": false
    },
    {
      "type": "text",
      "id": "description",
      "label": "Video alt text",
      "info": "Describe the video for accessibility"
    }
  ],
  "presets": [
    {
      "name": "Video"
    }
  ]
}
{% endschema %}

