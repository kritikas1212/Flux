{% comment %}
  FAQ Accordion Section
  Accessible, animated FAQ section with schema.org markup
{% endcomment %}

<section class="section-spacing" data-section-id="{{ section.id }}" data-section-type="faq-accordion" itemscope itemtype="https://schema.org/FAQPage">
  <div class="container-flux">
    
    {%- if section.settings.heading != blank -%}
      <div class="text-center mb-12 md:mb-16">
        <h2 class="mb-4">
          <span class="bg-flux-gradient bg-clip-text text-transparent">
            {{ section.settings.heading }}
          </span>
        </h2>
        
        {%- if section.settings.subheading != blank -%}
          <p class="text-muted text-lg max-w-2xl mx-auto">
            {{ section.settings.subheading }}
          </p>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="max-w-4xl mx-auto space-y-4">
      {%- for block in section.blocks -%}
        <div 
          class="group relative overflow-hidden rounded-2xl border border-border bg-secondary hover:border-accent-light transition-all duration-300"
          itemscope 
          itemprop="mainEntity" 
          itemtype="https://schema.org/Question"
          {{ block.shopify_attributes }}
        >
          <button
            type="button"
            class="flex items-center justify-between w-full p-6 text-left"
            aria-expanded="false"
            aria-controls="faq-{{ block.id }}"
            data-faq-toggle
          >
            <h3 class="text-lg font-semibold pr-8 flex-1" itemprop="name">
              {{ block.settings.question }}
            </h3>
            
            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-primary flex items-center justify-center group-hover:bg-accent transition-colors duration-300">
              <svg 
                class="w-4 h-4 transition-transform duration-300" 
                fill="none" 
                stroke="currentColor" 
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>
          </button>

          <div
            id="faq-{{ block.id }}"
            class="overflow-hidden transition-all duration-300 max-h-0"
            itemscope 
            itemprop="acceptedAnswer" 
            itemtype="https://schema.org/Answer"
            role="region"
            aria-labelledby="faq-question-{{ block.id }}"
          >
            <div class="px-6 pb-6 text-muted" itemprop="text">
              {{ block.settings.answer }}
            </div>
          </div>
        </div>
      {%- endfor -%}
    </div>

    {%- if section.settings.show_contact_button -%}
      <div class="text-center mt-12">
        <p class="text-muted mb-4">{{ section.settings.contact_text }}</p>
        <a href="{{ section.settings.contact_link }}" class="btn btn-outline">
          {{ section.settings.contact_button_text }}
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const faqToggles = document.querySelectorAll('[data-faq-toggle]');
    
    faqToggles.forEach(toggle => {
      toggle.addEventListener('click', function() {
        const content = this.nextElementSibling;
        const icon = this.querySelector('svg');
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        
        // Close all other FAQs
        faqToggles.forEach(otherToggle => {
          if (otherToggle !== toggle) {
            otherToggle.setAttribute('aria-expanded', 'false');
            otherToggle.nextElementSibling.style.maxHeight = '0';
            otherToggle.querySelector('svg').style.transform = 'rotate(0deg)';
          }
        });
        
        // Toggle current FAQ
        if (isExpanded) {
          this.setAttribute('aria-expanded', 'false');
          content.style.maxHeight = '0';
          icon.style.transform = 'rotate(0deg)';
        } else {
          this.setAttribute('aria-expanded', 'true');
          content.style.maxHeight = content.scrollHeight + 'px';
          icon.style.transform = 'rotate(180deg)';
        }
      });
    });
  });
</script>

{% schema %}
{
  "name": "FAQ Accordion",
  "tag": "section",
  "class": "faq-section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Find answers to common questions about our products and services"
    },
    {
      "type": "checkbox",
      "id": "show_contact_button",
      "label": "Show contact button",
      "default": true
    },
    {
      "type": "text",
      "id": "contact_text",
      "label": "Contact text",
      "default": "Still have questions?"
    },
    {
      "type": "text",
      "id": "contact_button_text",
      "label": "Contact button text",
      "default": "Contact Us"
    },
    {
      "type": "url",
      "id": "contact_link",
      "label": "Contact link"
    }
  ],
  "blocks": [
    {
      "type": "faq_item",
      "name": "FAQ Item",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question",
          "default": "What is your return policy?"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Answer",
          "default": "<p>We offer a 30-day return policy for all unused items in their original packaging.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "FAQ Accordion",
      "blocks": [
        {
          "type": "faq_item",
          "settings": {
            "question": "What is your shipping policy?",
            "answer": "<p>We offer free shipping on all orders over $50. Orders are processed within 1-2 business days.</p>"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "What is your return policy?",
            "answer": "<p>We offer a 30-day return policy for all unused items in their original packaging.</p>"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "Do you offer international shipping?",
            "answer": "<p>Yes, we ship to over 50 countries worldwide. International shipping rates vary by location.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}

