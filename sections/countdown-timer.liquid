{% comment %}
  Countdown Timer Section
  Urgency-building countdown for sales, launches, or events
{% endcomment %}

<section class="section-spacing relative overflow-hidden" data-section-id="{{ section.id }}" data-section-type="countdown-timer">
  <!-- Animated Background -->
  <div class="absolute inset-0 bg-gradient-to-br from-primary via-gradient1 to-gradient2 opacity-90"></div>
  
  <!-- Glow Effects -->
  <div class="absolute top-0 right-0 w-96 h-96 bg-accent rounded-full blur-3xl opacity-20 animate-glow-pulse"></div>
  <div class="absolute bottom-0 left-0 w-96 h-96 bg-accent-light rounded-full blur-3xl opacity-20 animate-glow-pulse" style="animation-delay: 1s;"></div>

  <div class="container-flux relative z-10">
    <div class="max-w-4xl mx-auto text-center">
      
      {%- if section.settings.heading != blank -%}
        <h2 class="text-4xl md:text-6xl font-bold mb-4 animate-fade-in">
          <span class="bg-flux-gradient bg-clip-text text-transparent">
            {{ section.settings.heading }}
          </span>
        </h2>
      {%- endif -%}

      {%- if section.settings.subheading != blank -%}
        <p class="text-muted text-xl mb-12 animate-fade-in">
          {{ section.settings.subheading }}
        </p>
      {%- endif -%}

      <!-- Countdown Display -->
      <div 
        class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-8 mb-12"
        data-countdown-timer
        data-end-date="{{ section.settings.end_date }}"
        data-end-time="{{ section.settings.end_time }}"
      >
        <div class="countdown-item">
          <div class="bg-secondary border border-accent/20 rounded-2xl p-6 backdrop-blur-sm shadow-glow hover:shadow-glow-lg transition-all duration-300">
            <div class="text-5xl md:text-6xl font-bold bg-flux-gradient bg-clip-text text-transparent mb-2" data-countdown-days>00</div>
            <div class="text-muted uppercase text-sm tracking-wide">{{ 'sections.countdown.days' | t }}</div>
          </div>
        </div>

        <div class="countdown-item">
          <div class="bg-secondary border border-accent/20 rounded-2xl p-6 backdrop-blur-sm shadow-glow hover:shadow-glow-lg transition-all duration-300">
            <div class="text-5xl md:text-6xl font-bold bg-flux-gradient bg-clip-text text-transparent mb-2" data-countdown-hours>00</div>
            <div class="text-muted uppercase text-sm tracking-wide">{{ 'sections.countdown.hours' | t }}</div>
          </div>
        </div>

        <div class="countdown-item">
          <div class="bg-secondary border border-accent/20 rounded-2xl p-6 backdrop-blur-sm shadow-glow hover:shadow-glow-lg transition-all duration-300">
            <div class="text-5xl md:text-6xl font-bold bg-flux-gradient bg-clip-text text-transparent mb-2" data-countdown-minutes>00</div>
            <div class="text-muted uppercase text-sm tracking-wide">{{ 'sections.countdown.minutes' | t }}</div>
          </div>
        </div>

        <div class="countdown-item">
          <div class="bg-secondary border border-accent/20 rounded-2xl p-6 backdrop-blur-sm shadow-glow hover:shadow-glow-lg transition-all duration-300">
            <div class="text-5xl md:text-6xl font-bold bg-flux-gradient bg-clip-text text-transparent mb-2" data-countdown-seconds>00</div>
            <div class="text-muted uppercase text-sm tracking-wide">{{ 'sections.countdown.seconds' | t }}</div>
          </div>
        </div>
      </div>

      {%- if section.settings.button_text != blank -%}
        <a href="{{ section.settings.button_link }}" class="btn btn-primary inline-block">
          {{ section.settings.button_text }}
        </a>
      {%- endif -%}

      <!-- Expired Message -->
      <div class="hidden" data-countdown-expired>
        <p class="text-2xl font-semibold text-muted">
          {{ section.settings.expired_text }}
        </p>
      </div>
    </div>
  </div>
</section>

<script>
  (function() {
    const timer = document.querySelector('[data-countdown-timer]');
    if (!timer) return;

    const endDate = timer.dataset.endDate;
    const endTime = timer.dataset.endTime || '23:59:59';
    const targetDate = new Date(`${endDate}T${endTime}`).getTime();

    const daysEl = timer.querySelector('[data-countdown-days]');
    const hoursEl = timer.querySelector('[data-countdown-hours]');
    const minutesEl = timer.querySelector('[data-countdown-minutes]');
    const secondsEl = timer.querySelector('[data-countdown-seconds]');
    const expiredEl = document.querySelector('[data-countdown-expired]');

    function updateCountdown() {
      const now = new Date().getTime();
      const distance = targetDate - now;

      if (distance < 0) {
        timer.style.display = 'none';
        if (expiredEl) {
          expiredEl.classList.remove('hidden');
        }
        return;
      }

      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);

      daysEl.textContent = String(days).padStart(2, '0');
      hoursEl.textContent = String(hours).padStart(2, '0');
      minutesEl.textContent = String(minutes).padStart(2, '0');
      secondsEl.textContent = String(seconds).padStart(2, '0');
    }

    updateCountdown();
    setInterval(updateCountdown, 1000);
  })();
</script>

{% schema %}
{
  "name": "Countdown Timer",
  "tag": "section",
  "class": "countdown-section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Limited Time Offer"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Don't miss out on this exclusive deal"
    },
    {
      "type": "text",
      "id": "end_date",
      "label": "End date",
      "info": "Format: YYYY-MM-DD (e.g., 2025-12-31)",
      "default": "2025-12-31"
    },
    {
      "type": "text",
      "id": "end_time",
      "label": "End time",
      "info": "Format: HH:MM:SS (24-hour format, e.g., 23:59:59)",
      "default": "23:59:59"
    },
    {
      "type": "text",
      "id": "expired_text",
      "label": "Expired message",
      "default": "This offer has ended"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Shop Now"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    }
  ],
  "presets": [
    {
      "name": "Countdown Timer"
    }
  ]
}
{% endschema %}

